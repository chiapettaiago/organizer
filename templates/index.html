<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MailNest - Organizador de E-mails</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="logo">
                <h1>üìÆ MailNest</h1>
                <p class="subtitle">Organize seus e-mails com intelig√™ncia</p>
            </div>

            <div class="credentials">
                <h3>üîê Credenciais do Gmail</h3>
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" placeholder="seu.email@gmail.com" required>
                </div>
                <div class="form-group">
                    <label for="senha">Senha de App:</label>
                    <input type="password" id="senha" placeholder="Senha de aplicativo" required>
                </div>
                <div class="form-group checkbox">
                    <input type="checkbox" id="excluir_inbox" checked>
                    <label for="excluir_inbox">Remover da INBOX ap√≥s organizar</label>
                </div>
                <div class="credentials-actions">
                    <button class="btn-secondary btn-small" onclick="salvarCredenciais()" id="btn-salvar-creds">
                        üíæ Salvar Credenciais
                    </button>
                    <button class="btn-danger btn-small" onclick="removerCredenciais()" id="btn-remover-creds" style="display: none;">
                        üóëÔ∏è Remover
                    </button>
                </div>
            </div>

            <div class="sidebar-info">
                <h4>‚ÑπÔ∏è Como usar</h4>
                <ul>
                    <li>Configure suas credenciais acima</li>
                    <li>Use uma senha de aplicativo do Gmail</li>
                    <li>Clique em "Organizar Agora" para iniciar</li>
                    <li>Acompanhe o progresso em tempo real</li>
                </ul>
            </div>

            {% if is_admin %}
            <div class="sidebar-admin">
                <h4>üëë Administra√ß√£o</h4>
                <a href="/admin/convites" class="admin-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1ZM10 17L6 13L7.41 11.59L10 14.17L16.59 7.58L18 9L10 17Z" fill="currentColor"/>
                    </svg>
                    Gerenciar C√≥digos de Convite
                </a>
                <a href="/admin/atividades" class="admin-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z" fill="currentColor"/>
                    </svg>
                    Hist√≥rico de Atividades
                </a>
            </div>
            {% endif %}
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HEADER -->
            <header class="header">
                <div class="header-left">
                    <h2>Painel de Controle</h2>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="currentColor"/>
                        </svg>
                        <span class="user-name">{{ user_name }}</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z" fill="currentColor"/>
                        </svg>
                        Sair
                    </button>
                </div>
            </header>
            <div class="metrics-bar">
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="metric-total">0</div>
                        <div class="metric-label">E-mails Organizados</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metric-duplicatas">0</div>
                        <div class="metric-label">Duplicatas Removidas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metric-categorias">0</div>
                        <div class="metric-label">Categorias Criadas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metric-status">‚èπÔ∏è</div>
                        <div class="metric-label">Status</div>
                    </div>
                </div>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-button active" onclick="openTab('executar')">‚ö° Executar</button>
                <button class="tab-button" onclick="openTab('logs')">üìã Logs</button>
                <button class="tab-button" onclick="openTab('ajuda')">‚ùì Ajuda</button>
            </div>

            <!-- TAB: EXECUTAR -->
            <div id="executar" class="tab-content active">
                <!-- Debug: is_admin = {{ is_admin }} -->
                <div class="actions">
                    <button class="btn btn-primary" onclick="organizarEmails()">
                        üìß Organizar Agora
                    </button>
                    <button class="btn btn-secondary" onclick="verificarDuplicatas()">
                        üîç Verificar Duplicatas
                    </button>
                    {% if is_admin %}
                    <a href="/admin/convites" class="btn btn-admin">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1ZM10 17L6 13L7.41 11.59L10 14.17L16.59 7.58L18 9L10 17Z" fill="currentColor"/>
                        </svg>
                        Gerenciar Convites
                    </a>
                    {% else %}
                    <!-- Debug: Bot√£o admin N√ÉO exibido porque is_admin = {{ is_admin }} -->
                    {% endif %}
                </div>

                <div class="progress-section" id="progress-section" style="display: none;">
                    <div class="progress-header">
                        <span id="progress-text">Aguardando...</span>
                        <span id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>

                <div class="live-logs" id="live-logs">
                    <h3>üì° Logs em Tempo Real</h3>
                    <div class="logs-container" id="logs-container">
                        <p class="log-empty">Nenhuma opera√ß√£o em andamento</p>
                    </div>
                </div>
            </div>

            <!-- TAB: LOGS -->
            <div id="logs" class="tab-content">
                <div class="logs-header">
                    <h3>üìú Hist√≥rico de Logs</h3>
                    <button class="btn btn-danger btn-sm" onclick="limparLogs()">üóëÔ∏è Limpar Logs</button>
                </div>
                <div class="logs-container" id="historico-logs">
                    <p class="log-empty">Nenhum log dispon√≠vel</p>
                </div>
            </div>

            <!-- TAB: AJUDA -->
            <div id="ajuda" class="tab-content">
                <div class="help-content">
                    <h3>üîß Configura√ß√£o do Gmail</h3>
                    <ol>
                        <li>Acesse <a href="https://myaccount.google.com/security" target="_blank">Configura√ß√µes de Seguran√ßa do Google</a></li>
                        <li>Ative a <strong>Verifica√ß√£o em duas etapas</strong></li>
                        <li>Acesse <strong>Senhas de app</strong></li>
                        <li>Crie uma nova senha para "MailNest"</li>
                        <li>Use essa senha no campo "Senha de App"</li>
                    </ol>

                    <h3>üìÅ Categorias Autom√°ticas</h3>
                    <ul>
                        <li><strong>Faturas:</strong> Boletos, pagamentos, notas fiscais</li>
                        <li><strong>Trabalho:</strong> Projetos, relat√≥rios, reuni√µes</li>
                        <li><strong>Pessoal:</strong> Convites, eventos, fam√≠lia</li>
                        <li><strong>Marketing:</strong> Promo√ß√µes, newsletters, ofertas</li>
                        <li><strong>Sistema:</strong> Alertas, erros, notifica√ß√µes</li>
                        <li><strong>Positivos:</strong> E-mails com sentimento positivo</li>
                        <li><strong>Problemas:</strong> E-mails com sentimento negativo</li>
                        <li><strong>Neutros:</strong> Outros e-mails</li>
                    </ul>

                    <h3>‚ö° Funcionalidades</h3>
                    <ul>
                        <li>‚úÖ Organiza√ß√£o autom√°tica por categoria</li>
                        <li>‚úÖ An√°lise de sentimento com IA</li>
                        <li>‚úÖ Detec√ß√£o e remo√ß√£o de duplicatas</li>
                        <li>‚úÖ Progresso em tempo real</li>
                        <li>‚úÖ Logs detalhados de cada opera√ß√£o</li>
                        <li>‚úÖ Interface responsiva e moderna</li>
                    </ul>

                    <h3>‚ö†Ô∏è Importante</h3>
                    <ul>
                        <li>Nunca compartilhe sua senha de aplicativo</li>
                        <li>O processo pode levar alguns minutos dependendo da quantidade de e-mails</li>
                        <li>Recomendamos fazer backup antes da primeira execu√ß√£o</li>
                        <li>A verifica√ß√£o de duplicatas √© limitada aos √∫ltimos 1000 e-mails</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
